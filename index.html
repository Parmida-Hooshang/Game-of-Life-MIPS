<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Game of Life: MIPS</title>

		<meta name="description" content="A MIPS assembly implementation of Conway's Game of Life ">
		<meta name="author" content="Parmida Hooshang & Mohammad hassan Liaghat">

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/dracula.css">
		<link href="https://fonts.googleapis.com/css2?family=Nosifer&family=IM+Fell+English&display=swap" rel="stylesheet">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>

	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>The Game of Life</h2>
					<p class="green-highlight">Parmida Hooshang X Sina Liaghat</p>
					<p class="paragraph" style="color: #C7253E;">Shiraz University - 2025</p>
				</section>

				<section>
					<h4>Where Bits Become Breath!</h4>
					
					<div class="gsa-canvas-wrapper">
						<!-- Left Column -->
						<div class="left-panel">
							<div id="gsa-inputs" class="gsa-inputs-container"></div>
							<div id="step-count" class="iterations-container"></div>
						</div>
						
						<!-- Right Column -->
						<div id="canvas" class="canvas-container"></div>
					</div>

					<div>
						<button id="load-btn" class="button">Load</button>
						<button id="start-btn" class="button" disabled>Start</button>
						<button id="next-btn" class="button" disabled>Next</button>
						<button id="reset-btn" class="button" disabled>Reset</button>
					</div>
				</section>

				<section>
					<section data-auto-animate>
						<h4>Big Bang</h4>
						<div style="text-align: left;">
							<p class="paragraph"><code style="font-weight: bold; color: #bf79db;">Genesis</code> is the starting point of the flow of life.
							It's when the destiny is unveiled through the <code style="font-weight: bold; color: #66d9ef;">Crystal_ball</code>.</p>
						</div>
						<pre data-id="code-animation"><code class="hljs mips" data-trim
							data-line-numbers="1,6"><script type="text/template">
							Genesis: 
								la		$a1, presence
								la		$a0, origin
								jal 	Resurrection		# presence = origin
								
								jal 	Crystal_ball

								la		$a1, presence
								la		$a0, origin
								jal 	Resurrection		# presence = origin

								# iterations -> days
								# walls -> corpse
						</script></code></pre>
					</section>

					<section data-auto-animate>
						<div style="text-align: left;">
							<p class="paragraph">Until the day that life becomes monotonous, today vanishes and <code style="font-weight: bold; color: #66d9ef;">Tomorrow</code> arrives.</p>
						</div>
						<pre data-id="code-animation"><code class="hljs mips" data-trim
							data-line-numbers="1,7|17,26"><script type="text/template">
							Genesis: 
								...
								la		$s5, days			
								lb		$s5, 0($s5)			# s5 = days
								addi	$s0, $zero, 0		# s0 = day counter
								
							_flow:

								# print presence
								...

								# print corpses
								...

								beq		$s0, $s5, _eternity	# if gone through all days
								
								jal 	Tomorrow

								la		$a1, presence
								la		$a0, in_between
								jal 	Resurrection		# presence = in_between

								addi 	$s0, $s0, 1
								j 		_flow

							_eternity:	
								addi 	$v0, $zero, 10
								syscall
						</script></code></pre>
					</section>
				</section>

				<section>
					<section data-auto-animate>
						<h4>Coming back to life</h4>
						<div style="text-align: left;">
							<p class="paragraph">Amongst the ashes of the dead is a <code style="font-weight: bold; color: #bf79db;">Physician</code> 
							looking for an ember of hope.</p>
						</div>
						<pre data-id="code-animation"><code class="hljs mips" data-trim
							data-line-numbers="1,6,10"><script type="text/template">
							Physician:
								addi	$t2, $zero, 0					# t2 = x counter
								addi	$t4, $zero, 8					# t4 = x limit
								addi	$t5, $zero, 12				# t5 = y limit

							_check1:
								beq		$t2, $t4, _endcheck1	# x is out of range
								
								addi	$t3, $zero, 0					# t3 = y counter
							_check2:
								beq 	$t3, $t5, _endcheck2	# y is out of range

								# call pulse and see if it's alive	
								addi	$a0, $t2, 0
								addi	$a1, $t3, 0
								
								addi	$sp, $sp, -20
								sw		$ra, 0($sp)
								sw		$t2, 4($sp)
								sw		$t3, 8($sp)
								sw		$t4, 12($sp)
								sw		$t5, 16($sp)

								jal 	Pulse

								lw		$ra, 0($sp)
								lw		$t2, 4($sp)
								lw		$t3, 8($sp)
								lw		$t4, 12($sp)
								lw		$t5, 16($sp)
								addi	$sp, $sp, 20

								beq		$v0, $zero, _skipcb		# if it's dead

								addi 	$t7, $zero, 1
								sllv 	$t7, $t7, $t3
								nor 	$t7, $t7, $zero			# 11..101..11
								la		$t8, corpse
								sll		$t9, $t2, 2				# which word * 4
								add		$t8, $t8, $t9			# t8 = address of the word
								lw		$t8, 0($t8)
								and 	$t8, $t8, $t7
								la		$t7, corpse
								add		$t7, $t7, $t9
								sw		$t8, 0($t7)				# update the word

							_skipcb:
								addi 	$t3, $t3, 1
								j 		_check2

							_endcheck2:

								addi 	$t2, $t2, 1
								j		_check1
								
							_endcheck1:
								jr 		$ra
						</script></code></pre>
					</section>

					<section data-auto-animate>
						<div style="text-align: left;">
							<p class="paragraph">May the dead rise from the ashes, with a scream of the
								<code style="font-weight: bold; color: #66d9ef;">Pulse</code>.
							</p>
						</div>
						<pre data-id="code-animation"><code class="hljs mips" data-trim
							data-line-numbers="1|24"><script type="text/template">
							Physician:
								addi	$t2, $zero, 0					# t2 = x counter
								addi	$t4, $zero, 8					# t4 = x limit
								addi	$t5, $zero, 12				# t5 = y limit

							_check1:
								beq		$t2, $t4, _endcheck1	# x is out of range
								
								addi	$t3, $zero, 0					# t3 = y counter
							_check2:
								beq 	$t3, $t5, _endcheck2	# y is out of range

								# call pulse and see if it's alive	
								addi	$a0, $t2, 0
								addi	$a1, $t3, 0
								
								addi	$sp, $sp, -20
								sw		$ra, 0($sp)
								sw		$t2, 4($sp)
								sw		$t3, 8($sp)
								sw		$t4, 12($sp)
								sw		$t5, 16($sp)

								jal 	Pulse

								lw		$ra, 0($sp)
								lw		$t2, 4($sp)
								lw		$t3, 8($sp)
								lw		$t4, 12($sp)
								lw		$t5, 16($sp)
								addi	$sp, $sp, 20

								beq		$v0, $zero, _skipcb		# if it's dead

								addi 	$t7, $zero, 1
								sllv 	$t7, $t7, $t3
								nor 	$t7, $t7, $zero			# 11..101..11
								la		$t8, corpse
								sll		$t9, $t2, 2				# which word * 4
								add		$t8, $t8, $t9			# t8 = address of the word
								lw		$t8, 0($t8)
								and 	$t8, $t8, $t7
								la		$t7, corpse
								add		$t7, $t7, $t9
								sw		$t8, 0($t7)				# update the word

							_skipcb:
								addi 	$t3, $t3, 1
								j 		_check2

							_endcheck2:

								addi 	$t2, $t2, 1
								j		_check1
								
							_endcheck1:
								jr 		$ra
						</script></code></pre>
					</section>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>

		<script type="module">
			import { load, tomorrow } from "./interpreter/interface.js";
			window.Interface = { load, tomorrow };
		</script>

		<script>
			let origGsa = [
				0x00000107,
				0x00000000, 
				0x000000F0,
				0x00000000,
				0x00000AAB, 
				0x00000000,
				0x000000D0,
				0x000000F0
			];

			let gsa = [
				0x00000107,
				0x00000000, 
				0x000000F0,
				0x00000000,
				0x00000AAB, 
				0x00000000,
				0x000000D0,
				0x000000F0
			];

			let corpse = [
				0x00000000,
				0x00000000, 
				0x00000000,
				0x00000000,
				0x00000000, 
				0x00000000,
				0x00000000,
				0x00000000
			];

			let origCount = 0;

			let count = 0;

			let isRunning = false;

			function renderCanvas() {
				const container = document.getElementById('canvas');
				container.innerHTML = '';

				// Create title
				const title = document.createElement('div');
				title.className = 'canvas-title';
				title.textContent = 'Canvas';
				container.appendChild(title);

				// Create cells
				gsa.forEach((row, rowIndex) => {
					const gsaBinary = (row >>> 0).toString(2); // Convert to unsigned 32-bit
					const corpseBinary = (corpse[rowIndex] >>> 0).toString(2); 

					const bits = gsaBinary.padStart(32, '0').slice(-12).split('').reverse().join('');
					const corpseBits = corpseBinary.padStart(32, '0').slice(-12).split('').reverse().join('');

					for (let colIndex = 0; colIndex < 12; colIndex++) {
						const cell = document.createElement('div');
						cell.className = 'cell';

						if (corpseBits[colIndex] === '1') {
							cell.classList.add('corpse');
						}

						else if (bits[colIndex] === '1') {
							cell.classList.add('alive');
						}

						container.appendChild(cell);
					}
				});
			}

			function renderGSA() {
				const container = document.getElementById('gsa-inputs');
				container.innerHTML = ''; 

				// Create title
				const title = document.createElement('div');
				title.className = 'gsa-title';
				title.textContent = 'GSA';
				container.appendChild(title);

				// Create input fields
				gsa.forEach((row, index) => {
					const input = document.createElement('input');
					input.className = 'input-field';
					input.value = `0x${row.toString(16).padStart(8, '0').toUpperCase()}`;
					input.dataset.row = index;
					container.appendChild(input);
				});
			}

			function renderIters() {
				const container = document.getElementById('step-count');
				container.innerHTML = '';
				
				// Create input field
				const input = document.createElement('input');
				input.className = 'input-field';
				input.id = 'stepCount';
				input.placeholder = 'Steps';
				container.appendChild(input);
			}

			function updateButtonStates(enLoad, enStart, enNext, enReset) {
				document.getElementById('load-btn').disabled = !enLoad;
				document.getElementById('start-btn').disabled = !enStart;
				document.getElementById('next-btn').disabled = !enNext;
				document.getElementById('reset-btn').disabled = !enReset;
			}

			function updateInputStates(enInputs) {
				document.querySelectorAll('.input-field').forEach(input => {
					input.disabled = !enInputs;
				});
			}

			function updateInputContents() {
				// Update GSA input fields
				const gsaInputs = document.querySelectorAll('#gsa-inputs .input-field');
				gsa.forEach((value, index) => {
					if (gsaInputs[index]) {
						gsaInputs[index].value = `0x${value.toString(16).padStart(8, '0').toUpperCase()}`;
					}
				});

				// Update step count
				const stepCountInput = document.getElementById('stepCount');
				if (stepCountInput) {
					stepCountInput.value = count;
				}
			}

			function handleLoad() {
				updateButtonStates(false, true, true, true);
				updateInputStates(false);

				const stepCount = parseInt(document.getElementById('stepCount').value);
				
				// Get all GSA input values
				const gsaInputs = document.querySelectorAll('#gsa-inputs .input-field');
				const newGsa = Array.from(gsaInputs).map(input => {
					// Convert hex string to number 
					const hexValue = input.value.startsWith('0x') 
						? input.value.substring(2) 
						: input.value;
					return parseInt(hexValue, 16);
				});
	
				const result = window.Interface.load(newGsa, stepCount);
	
				// Update game state
				origGsa = newGsa;
				gsa = newGsa;
				corpse = result.corpse;
				origCount = result.days;
				count = result.days;

				updateInputContents();
				
				// Update the canvas
				renderCanvas();
			}

			function handleStart() {
				updateButtonStates(false, false, false, true); 
				updateInputStates(false);
				isRunning = true;

				const stepsToProcess = count;
				
				(async function processSteps() {
					for (let i = 0; i < stepsToProcess; i++) {
						if (!isRunning)
							break;
						gsa = window.Interface.tomorrow(gsa);
						count--;
						updateInputContents();
						renderCanvas();
						
						// Add delay between steps (500ms)
						await new Promise(resolve => setTimeout(resolve, 500));
					}
				})();
			}

			function handleNext() {
				updateButtonStates(false, false, count >= 2, true);
				gsa = window.Interface.tomorrow(gsa);
				count--;
				updateInputContents();
				renderCanvas();
			}

			function handleReset() {
				updateButtonStates(true, false, false, false);
				updateInputStates(true);
				isRunning = false;
				gsa = origGsa;
				count = origCount;
				corpse.fill(0);
				renderCanvas();
				updateInputContents();
			}

			document.addEventListener('DOMContentLoaded', () => {
				// Button event listeners
				document.getElementById('load-btn').addEventListener('click', handleLoad);
				document.getElementById('start-btn').addEventListener('click', handleStart);
				document.getElementById('next-btn').addEventListener('click', handleNext);
				document.getElementById('reset-btn').addEventListener('click', handleReset);

				// Initialize Reveal
				Reveal.initialize({
					hash: true,
					plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
				}).then(() => {
					renderCanvas();
					renderGSA();
					renderIters();
				});
			});
		</script>
	</body>
</html>